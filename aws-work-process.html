<!--
@license
Copyright (c) 2015 dean wagner wagner@nmb.gov. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../firebase-element/firebase-collection.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<!-- <link rel="import" href="../bower_components/firebase-element/firebase-document.html"> -->

<!--
An element providing a solution to no problem in particular.

Example:

    <aws-work-process></aws-work-process>

@demo
-->
<dom-module id="aws-work-process">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
      border-radius: 5px;
      margin: 5px;
      padding: 10px;
      background-color: gray;
      color: white;
      font-family: 'Roboto', 'Noto', sans-serif;
      font-size: 16px;
    }

    .iron-selected {
      background-color: #eee;
      color: black;
    }

    iron-selector > div:hover {
      background-color: #ddd;
    }

    .width200 {
      width:150px;

    }

    .red {
      color: red;
      background-color: #ffaaaa;
    }

    #arblist {
      @apply(--layout-horizontal);
      @apply(--layout-center);
    }


  </style>

  <template>

    <firebase-collection
        location="{{_arbmonthsUrl}}"
        data="{{_arbmonths}}">
    </firebase-collection>


    <h2>{{_computeDisplayDate(_selectedArbmonth)}}</h2>

    <iron-selector selected="{{_selectedArbmonth}}" attr-for-selected="caseid">

        <template is="dom-repeat" items="{{_arbmonths}}">
        <div caseid="{{item.__firebaseKey__}}" id="arblist">
            <span class="width200">{{_computeDisplayDate(item.__firebaseKey__)}}</span>

            
            <paper-icon-button 
                title="still editing a work request"
                icon="create" 
                class$="{{_pendreqClass(item.stat)}}">
            </paper-icon-button>
            <paper-icon-button 
                title="request submitted, staff reviewing"
                icon="assignment-turned-in" 
                class$="{{_subreqClass(item.stat)}}">
            </paper-icon-button>
            <paper-icon-button 
                title="waiting director approval"
                icon="done-all" 
                class$="{{_subreqClass(item.stat)}}">
            </paper-icon-button>
            <paper-icon-button 
                title="open for work reporting"
                icon="work" 
                class$="{{_valreqClass(item.stat)}}">
            </paper-icon-button>
            <paper-icon-button 
                title="report submitted, staff reviewing"
                icon="assignment-turned-in" 
                class$="{{_reqappClass(item.stat)}}">
            </paper-icon-button>
            <paper-icon-button 
                title="report waiting for director approval"
                icon="done-all" 
                class$="{{_subrptClass(item.stat)}}">
            </paper-icon-button>

          </div>
        </template>

    </iron-selector>


  </template>

</dom-module>

<script>

  Polymer({

    is: 'aws-work-process',

    properties: {
      

      /**
       * Database url for the firebase-collection connection to get assignment objects.
       *
       * @type String
       */
      fbUrl: {
        type: String,
        observer: '_alertFB'
      },
      /**
       * uid of the user used a a key for the user node
       *
       * @type String
       */
      userUid: {
        type: String,
        observer: '_alertUID'
      },

      _arbmonths: {
        type: Array,
        value: function () {return [];}
      },
      _arbmonthsUrl: String,
      // _selectedArbmonth: {
      //   type: Number,
      //   value: 3
      // }
      // _selectedArbmonth: {
      //   type: Object,
      //   observer: 'ckmonth'
      // }
      _selectedArbmonth: {
        type: String,
        observer: 'ckmonth'
      }, 

      _months: {
        type: Array,
        value: function () {
          return ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        }
      }

    },

    _alertFB: function(newValue, oldValue) {
      console.log("FB = " + this.fbUrl);
    },

    _alertUID: function (newValue, oldValue) {
      console.log("UID = " + this.userUid);
    },

    ckmonth: function () {
      //alert("yo");
    },


    observers: [
      'updateUrls(fbUrl, userUid)'
    ],

    updateUrls: function(fbUrl, userUid) {
      console.log("in updateUrls");
      this._assembleUrls();
    },


    // Element Lifecycle
    ready: function () {
      console.log("in ready");
    },

    attached: function () {
      console.log("in attached");
    },

    detached: function () {
      console.log("in detached");
    },

    _assembleUrls: function () {
      this._arbmonthsUrl = this.fbUrl + "/users/" + this.userUid + "/arbmonths";
      console.log("in assembleUrls, 2 " + this._arbmonthsUrl);
    },


    
    // Element Behavior

    //arbmonth list

    _computeDisplayDate: function (caseID) {
      // alert("in _computeDisplayDate(item.caseID), " + caseID);
      var splt= caseID.split('-');
      var dateindex = parseInt(splt[1]) - 1;
      return this._months[dateindex] + ", " + splt[0];
    },

    _pendreqClass: function (stat) {
      if (stat == "PENDING_REQ") {
        return "red"
      } else {
        return "grey"
      }
    },

    _subreqClass: function (stat) {
      if (stat == "SUBMITTED_REQ") {
        return "red"
      } else {
        return "grey"
      }
    },

    _valreqClass: function (stat) {
      if (stat == "VALID_REQ") {
        return "red"
      } else {
        return "grey"
      }
    },
    _reqappClass: function (stat) {
      if (stat == "REQ_APPROVED") {
        return "red"
      } else {
        return "grey"
      }
    },
    _subrptClass: function (stat) {
      if (stat == "SUBMITTED_RPT") {
        return "red"
      } else {
        return "grey"
      }
    },
    _valrptClass: function (stat) {
      if (stat == "VALID_RPT") {
        return "red"
      } else {
        return "grey"
      }
    }


  });

</script>
